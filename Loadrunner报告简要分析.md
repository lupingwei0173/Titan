---
title: Loadrunner报告简要分析
date: 2019-11-05 09:47:27
tags: LR报告分析
categories: 技术分享
---

引言
LoadRunner性能测试结果分析是个复杂的过程,通常可以从结果摘要、并发数、平均事务响应时间、每秒点击数、业务成功率、系统资源、网页细分图、Web服务器资源、数据库服务器资源等几个方面分析。
(一)结果摘要
LoadRunner进行场景测试结果进行分析后概要中列出了场景执行情况：
Analysis Summary:分析概要
Statistics Summary:统计信息概要表
Transaction Summary:事务摘要 
HTTP Responses Summary:HTTP 响应概要
![](1.jpg)
1、分析概要
Period:时间段
Scenario Name:测试场景的名称
Results in Scenario:结果存放路径
Duration:场景的持续时间
本次测试从15:58:40开始,到16:29:42结束,共历时31分2秒。
![](2.jpg)
2、统计信息概要表
Maximum Running Vusers:最大并发数为7
Total Throughput(bytes):总吞吐量为842037409字节
Average Throughput(bytes/second):平均每秒吞吐量为451979字节
Total Hits:总的请求数,即总点击数为211974次
Average Hits per Second:平均每秒的请求,即平均点击数为113.781
Total error:错误总数
单位时间内吞吐量越大,说明服务器的处理能越好,请求数仅表示客户端向服务器发出的请求数,与吞吐量一般是成正比关系。
![](3.jpg)
3、事务摘要
Transcation:事务成功失败数
Average Responses Time:平均响应时间
4、HTTP 响应概要
"HTTP 200"- -表示请求被正确响应
"HTTP 404"- -表示文件或者目录未能找到。
本部分显示在场景执行过程中,每次HTTP请求发出去的状态- -成功or失败
本次测试过程中LoadRunner共模拟发出了211974次请求,其中"HTTP 200"为209811次,而"HTTP 404"为2163,说明在本次测试过程中发出的请求大部分都能正确响应了,仅有部分失败了,但事务成功率为100%
出现这样现象的原因是脚本有些页面的请求内容并非关键点,比如可能请求先前的cookie信息,如果没有就重新获取,所以不会影响最终的测试结果。
![](4.jpg)
常用的HTTP状态代码如下：
400 无法解析此请求。
401.1 未经授权：访问由于凭据无效被拒绝。
401.2 未经授权: 访问由于服务器配置倾向使用替代身份验证方法而被拒绝。
401.3 未经授权：访问由于 ACL 对所请求资源的设置被拒绝。
401.4 未经授权：Web 服务器上安装的筛选器授权失败。
401.5 未经授权：ISAPI/CGI 应用程序授权失败。
401.7 未经授权：由于 Web 服务器上的 URL 授权策略而拒绝访问。
403 禁止访问：访问被拒绝。
403.1 禁止访问：执行访问被拒绝。
403.2 禁止访问：读取访问被拒绝。
403.3 禁止访问：写入访问被拒绝。
403.4 禁止访问：需要使用 SSL 查看该资源。
403.5 禁止访问：需要使用 SSL 128 查看该资源。
403.6 禁止访问：客户端的 IP 地址被拒绝。
403.7 禁止访问：需要 SSL 客户端证书。
403.8 禁止访问：客户端的 DNS 名称被拒绝。
403.9 禁止访问：太多客户端试图连接到 Web 服务器。
403.10 禁止访问：Web 服务器配置为拒绝执行访问。
403.11 禁止访问：密码已更改。
403.12 禁止访问：服务器证书映射器拒绝了客户端证书访问。
403.13 禁止访问：客户端证书已在 Web 服务器上吊销。
403.14 禁止访问：在 Web 服务器上已拒绝目录列表。
403.15 禁止访问：Web 服务器已超过客户端访问许可证限制。
403.16 禁止访问：客户端证书格式错误或未被 Web 服务器信任。
403.17 禁止访问：客户端证书已经到期或者尚未生效。
403.18 禁止访问：无法在当前应用程序池中执行请求的 URL。
403.19 禁止访问：无法在该应用程序池中为客户端执行 CGI。
403.20 禁止访问：Passport 登录失败。
404 找不到文件或目录。
404.1 文件或目录未找到：网站无法在所请求的端口访问。(此错误仅会出现在具有多个IP地址的计算机上)
404.2 文件或目录无法找到：锁定策略禁止该请求。
404.3 文件或目录无法找到：MIME 映射策略禁止该请求。
405 用于访问该页的 HTTP 动作未被许可。
406 客户端浏览器不接受所请求页面的 MIME 类型。
407 Web 服务器需要初始的代理验证。
410 文件已删除。
412 客户端设置的前提条件在 Web 服务器上评估时失败。
414 请求 URL 太大，因此在 Web 服务器上不接受该 URL。
500 服务器内部错误。
500.11 服务器错误：Web 服务器上的应用程序正在关闭。
500.12 服务器错误：Web 服务器上的应用程序正在重新启动。
500.13 服务器错误：Web 服务器太忙。
500.14 服务器错误：服务器上的无效应用程序配置。
500.15 服务器错误：不允许直接请求 GLOBAL.ASA。
500.16 服务器错误：UNC 授权凭据不正确。
500.17 服务器错误：URL 授权存储无法找到。
500.18 服务器错误：URL 授权存储无法打开。
500.19 服务器错误：该文件的数据在配置数据库中配置不正确。
500.20 服务器错误：URL 授权域无法找到。
500 100 内部服务器错误：ASP 错误。
501 标题值指定的配置没有执行。
502 Web 服务器作为网关或代理服务器时收到无效的响应。
(二)并发数分析
Running Vusers- - 运行的并发数,显示了在场景执行过程中并发数的执行情况。
图表中显示Vuser的状态、完成脚本的Vuser的数量以及集合统计信息,将这些图与事务图结合使用可以确定Vuser的数量对事务响应时间产生的影响。
下图显示了某考勤系统性能测试过程中Vusers运行情况,Vusers的运行趋势与我们场景执行计划中的设置是一样,表明在场景执行过程中，Vusers是按照我们预期的设置运行的,没有Vuser出现运行错误。
从另一个侧面说明我们的参数化设置是正确的,因为使用唯一数进行参数化设置,如果设置不正确，将会导致Vuser运行错误。
![](5.jpg)
测试脚本中我们还使用了集合点,那么这里还可以看看集合点在场景执行过程中的表现,点击左边添加新图
展开"Vusers"前的加号,双击“Rendezvous",即可生成集合点的图形后
![](6.jpg)
集合点的图形如图所示,从图中可以看到,所有用户到达集合点后,立刻就释放了。
与之前设定的集合点策略设置"所有运行用户到达后释放"是一致的。
假设Running的Vusers有10个,集合点策略设置是"所有运行用户到达后释放",而集合点图形显示的最大释放Vusers是7个,那么就表示有些Vuser超时了,引起超时的原因有可能是Vuser得到的响应超时了。
而本次测试Running Vusers与集合点是一致,说明整个场景执行过程中,并发数用户的执行正确,测试的系统服务器能够应付7个并发用户的业务操作。
![](7.jpg)
Ps:loadrunner场景中怎么设置集合点?
集合点和事务通常是一起使用,但集合点只能插入事务开始之前,事务中是不能插入集合点的。
1、在场景窗口的界面点菜单中的"scenario"
2、选择"rendezvous"
3、点击"policy"
4、设置x个集合点作为并发用户数,进行勾选上vusers arrive at the的一项
5、设置完成之后,rendez中开始进行集合,x个过后进行执行脚本。(也可以设置不同策略)

(三)响应时长
Average Transaction Response Time- -平均事务响应时间
如下图登录部分对应的事务是"submit_login",提交对应的事务是"submit_sign",对应的平均响应时间分别是4.425s和0.848s
提交的事务响应时间0.848秒小于预期的3秒,达到了要求,而登录是4.425秒去除思考时间,登录功能的实际事务时间应该是4.425s-3s=1.425s,小于预期的3s,故登录的事务响应时间也达到了要求。
"90 Percent Time"表示90%的事务服务器的响应都维持在某个值附近,如果平均事务响应时间波动较大,使用"Average Time"其实并不是准确,而使用"90 Percent Time"较准确。
如果平均事务响应时间波动较平缓,使用"Average Time"或"90 Percent Time"无区别
![](8.jpg)
(四)每秒点击数
"Hits per Second"- -每秒点击数,反映了客户端每秒钟向服务器端提交的请求数量,与平均每秒吞吐量成正比。
从图可以看出,两种图形的曲线基本一致,说明服务器能及时的接受客户端的请求,并能够返回结果。
如果"Hits per Second"正常,而"Average Throughput (bytes/second)"不正常,则表示服务器虽然能够接受服务器的请求,但返回结果较慢,有可能是程序处理缓慢的原因。
如果"Hits per Second"不正常,则说明客户端存在问题,一般有可能是网络引起的或是录制的脚本有问题,未能正确的模拟用户的行为。
一般情况下,这两种指标可以组合来用于性能调优,比如要比较某两种硬件平台的优劣,控制其他变量一致,比较上述两指标可得一个较优的配置。
![](9.jpg)
(四)业务成功率
业务成功率实际上是指"Transaction Summary"中每个事务的成功率。
由图可知,所有的事务都是绿色的,即表示为Passed,同时除了vuser_init与vuser_end两个事务,其他的事务通过数为2163,也就表明在30分钟的时间里,共完成了2163次操作。
那么根据这些可以判断本次测试登录与提交业务的成功率是100%
![](10.jpg)
(五)系统资源
此信息显示在场景执行过程中被监控的机器系统资源使用情况,一般情况下监控机器的CPU、内存、网络、磁盘等各个方面。
本次测试监控的CPU使用率、可用物理内存、CPU的队列长度三个指标的曲线逗较为平滑，三者的平均值分别为：53.582%、83.456M、8.45
测试服务器总的物理内存为384M,那么内存使用率为(384-83.456)/384=78.26%
根据Windwos资源性能指标的解释,一般如果CPU的队列长度一直超过二,则表示处理器可能堵塞,而得出的数据为8.45,且总体上保持平衡,由此推断测试服务器的CPU达到瓶颈。
且场景执行到23分半钟的时候,报出了错误"未找到引用源",意思是说被监控的服务器当前无法再进行计数器数据的获取了,so本次操作系统资源的监控只得到了场景执行的前23分半钟的数据。
![](11.jpg)
![](1.png)
(六)网页细分图
网页细分图可以评估页面内容是否影响事务响应时间。
点击左边添加新图,展开"Web Page Diagnostics"前的加号,双击"Page Download Time Breakdown"即可以得到直方图
![](12.jpg)
下图详细列出了每个页面所消耗的时间分布及指标含义,通过这些指标的数据,我们可以判断是哪个页面、哪个请求导致了响应时间变长,甚至响应失败。
![](13.jpg)
![](2.png)
(七)Web服务器资源(摘)
上述所有的监控图形LoadRunner都可以提供,但对于某些测试监控图来说,监控Tomcat、Jboss或者其他的Web服务器可以SiteScope工具,这个工具配置较为复杂。
使用ManageEngine Applications Manager 8来监控Tomcat,测试结束后得出Tomcat的JVM使用率如下：
从图中我们可以明显看出,Tomcat的JVM使用率不断上升,配置Tomcat时共分配了100M左右的物理内存给其,测试初期使用的JVM相对来说较少,我们的测试场景是从15:58:40开始,到16:29:42结束,历时31分2秒。
从图中看到,从16:00到16:30这个时间内,也就是测试场景执行期间,JVM的使用率不断上升,并没有在请求达到均衡状态后也呈现一种平衡状态。
所以,从这点可以推断如果测试场景继续执行或者加大并发数,最终必将导致Tomcat内存不够用而报出"Out Of Memory"内存溢出的错误。
在正常情况下,内存的使用应该与"Hit per Second"、"Average Throughput (bytes/second)"等监控图的图形走势是一致的。
![](14.jpg)
从上述过程可以得出一个结论,出现图中的问题,可能有两个原因：
1、Tomcat的内存分配不足；
2、程序代码有错误，可能导致内存泄露。
解决方法：
1、为Tomcat分配更多的内存,如果是使用的catalina.sh或Catalina.bat启动的Tomcat,则可在这两个文件中添加“SET CATALINA_OPTS= -Xms300m–Xmx300m”
如果使用的winnt服务方式启动的Tomcat,则可在"运行"中输入"regedit"进入注册表，然后在“HKEY_LOCAL_MACHINE–>SOFTWARE–>Apache Software Foundation–>Process Runner 1.0–>Tomcat5–>Parameters”修改两个属性,一个是JvmMs,另外一个是JvmMx
2、检查程序代码，使用一些内存泄露检查工具进行清查。
![](15.jpg)
(八)数据库服务器资源(摘)
数据库服务器资源监控相对来说就复杂的多了,现在常用的数据有Mysql、SQL Server、Oracle、DB2等,LoadRunner提供对后面几种数据库的监控方法,但对Mysql没有提供对应的监控方法。数据库如何监控可自行查阅